# List of steps
STEPS=(
	LIVECD_PWD LIVECD_NETWORK LIVECD_DATETIME
	SYSTEM_PARTITION SYSTEM_FORMAT SYSTEM_MOUNT SYSTEM_STAGE3 SYSTEM_MAKECONF SYSTEM_DNS SYSTEM_MOUNTFORCHROOT SYSTEM_COPYSCRIPTS SYSTEM_ACTIVATECHROOT SYSTEM_CHROOT
	CHROOT_CUSTO CHROOT_BOOT CHROOT_PORTAGETREEWEBSYNC CHROOT_PORTAGETREESYNC CHROOT_PROFILE CHROOT_FSTAB CHROOT_HOST CHROOT_MTAB CHROOT_CPU CHROOT_CCACHE
	CHROOT_KERNEL CHROOT_GENKERNEL CHROOT_KERNELCOMPILATION
	CHROOT_ROOTPWD CHROOT_CREATEUSER
	CHROOT_INSTALLBASIC CHROOT_INSTALLGENTOOTOOLS
	CHROOT_GRUB
	CHROOT_CLEANUP
	SYSTEM_CLEANUP
	SYSTEM_ACTIVATEFINALINSTALL SYSTEM_GETCHROOTSTEPS SYSTEM_UMOUNT
)
TOTAL_STEPS=${#STEPS[@]}
for ((i=0; i < $TOTAL_STEPS; i++)); do
    name=${STEPS[i]}
    declare -r ${name}=$i
done

# Usefull functions
yell() { echo "$0: $*" >&2; }
die() { yell "$*"; exit 1; }
try() { "$@" || die "Impossible de lancer $*"; }

task_check() {
	local TMP=$2/$1
	if [[ -e $TMP ]]
	then
		false
	else
		true
	fi
}

task_skip() {
	local TMP=$1
	echo "Tâche déjà effectuée (${TMP})"
}

task_done() {
	local TMP=$2/$1
	touch $TMP
	echo "Tâche effectuée"
}

